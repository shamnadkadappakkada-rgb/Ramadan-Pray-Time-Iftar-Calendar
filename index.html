<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Worldwide Ramadan Calendar</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Poppins:wght@300;400;600;700&display=swap');

/* Body & Background */
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:radial-gradient(ellipse at bottom,#0d1b2a 0%,#000814 100%);
  color:white;
  overflow-x:hidden;
  position:relative;
}

/* üåü Stars */
.stars{
  position:fixed;
  top:0; left:0; width:100%; height:100%; z-index:0; overflow:hidden;
}
.star{
  position:absolute;
  width:2px; height:2px;
  background:white; border-radius:50%;
  animation:twinkle 3s infinite ease-in-out;
}
@keyframes twinkle{
  0%,100%{opacity:0.2;}50%{opacity:1;}
}

/* üåô Moon Right */
.moon-right{
  top:80px; right:60px;
  width:150px; height:150px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #fffef5 0%, #f8e8c8 35%, #d4af37 60%, #a67c00 100%);
  box-shadow:0 0 60px rgba(255,215,0,0.8),
             0 0 120px rgba(255,215,0,0.4),
             inset -25px -25px 40px rgba(0,0,0,0.45),
             inset 15px 15px 25px rgba(255,255,255,0.25);
  animation:floatMoonRight 6s ease-in-out infinite;
  z-index:1;
}

/* üåü Floating Golden Star Left (with subtle twinkle) */
.star-left{
  top:100px; left:60px;
  width:120px; height:120px;
  border-radius:50%;
  background: radial-gradient(circle at 50% 50%, #fff8c0 0%, #ffd700 40%, #ffbf00 70%, #ff9900 100%);
  box-shadow: 0 0 80px rgba(255,223,0,0.8),
              0 0 150px rgba(255,215,0,0.4),
              inset -20px -20px 40px rgba(255,215,0,0.3),
              inset 10px 10px 20px rgba(255,255,255,0.2);
  animation:floatGoldenStar 7s ease-in-out infinite, twinkleStar 2.5s infinite alternate;
  z-index:1;
}

/* Animations */
@keyframes floatMoonRight{
  0%{transform:translateY(0);}
  50%{transform:translateY(-25px);}
  100%{transform:translateY(0);}
}

@keyframes floatGoldenStar{
  0%{transform:translateY(0) rotate(0deg);}
  50%{transform:translateY(-20px) rotate(45deg);}
  100%{transform:translateY(0) rotate(0deg);}
}

/* Twinkle effect for the star */
@keyframes twinkleStar{
  0%{opacity:0.7; transform:scale(1);}
  50%{opacity:1; transform:scale(1.1);}
  100%{opacity:0.7; transform:scale(1);}
}

/* Top Banner - Countdown & Fajr/Iftar Highlights */
.top-banner{
  text-align:center;
  padding:150px 10px 20px;
  position:relative;
  z-index:2;
  display:grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap:15px;
  align-items:center;
}
.arabic-main{
  font-family:'Amiri',serif;
  font-size:42px;
  color:#FFD700;
  grid-column:1/-1;
}
.english-main{
  font-size:32px;
  color:#FFD700;
  margin-top:5px;
  grid-column:1/-1;
}
.developer-line{
  margin-top:8px;
  font-size:14px;
  opacity:0.9;
  grid-column:1/-1;
}
#todayDateDisplay{
  color:#FFD700;
  font-weight:600;
  margin-top:10px;
  grid-column:1/-1;
}

/* Timer Box Column */
.timer-box{
  padding:15px;
  border-radius:15px;
  background:rgba(212,175,55,0.15);
  border:1px solid rgba(212,175,55,0.6);
  box-shadow:0 0 15px rgba(212,175,55,0.5);
}
.timer-box p{
  margin:5px 0;
  font-weight:600;
  color:#FFD700;
}
.fajr-iftar{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
.fajr-iftar img{
  width:30px;
  margin-bottom:5px;
}

/* Table */
table{width:100%;margin-top:25px;border-collapse:collapse;background:rgba(0,0,0,0.85);}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.2);text-align:center;}
th{background:#1f2833;}
.highlight{background:rgba(212,175,55,0.18);border:1px solid rgba(212,175,55,0.5);color:#FFD700;font-weight:600;border-radius:6px;padding:6px;}
.current-day{background:rgba(212,175,55,0.25);border-left:3px solid #FFD700;}
.hijri-date{font-size:13px;opacity:0.8;}
</style>
</head>
<body>

<!-- Stars & Moons -->
<div class="stars" id="stars"></div>
<div class="moon-right"></div>
<div class="moon-left"></div>

<!-- Top Banner -->
<div class="top-banner">
  <div class="arabic-main">ÿ±ŸÖÿ∂ÿßŸÜ ŸÖÿ®ÿßÿ±ŸÉ</div>
  <div class="english-main">Ramadan Mubarak</div>
  <div class="developer-line">Developed by: Shamnad Sharafudeen (D-Bross)</div>
  <p id="todayDateDisplay"></p>

  <div class="timer-box">
    <h2 id="nextPrayerDisplay"></h2>
    <div id="countdownTimer"></div>
  </div>

  <div id="todayPrayers"></div>
</div>

<!-- Calendar & Controls -->
<div class="container" id="content">
  <div class="controls">
    <select onchange="changeLanguage(this.value)">
      <option value="en">English</option>
      <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
      <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
      <option value="ur">ÿßÿ±ÿØŸà</option>
    </select>

    <button onclick="getLocation()">üìç Auto Detect</button>
    <input type="text" id="city" placeholder="Enter City">
    <button onclick="manualSearch()">Search</button>
    <button onclick="downloadPDF()">üìÑ PDF</button>
    <button onclick="toggleAdhaan()" id="adhaanBtn">üîä Auto Adhaan ON</button>
  </div>

  <div id="calendar"></div>
</div>

<!-- Adhaan Audio -->
<audio id="adhaanAudio" preload="auto">
  <source src="https://cdn.islamic.network/audio/adhan/adhan.mp3" type="audio/mpeg">
</audio>

<script>
/* ===== Stars Animation ===== */
const starContainer=document.getElementById("stars");
for(let i=0;i<250;i++){
  let star=document.createElement("div");
  star.classList.add("star");
  star.style.top=Math.random()*100+"%";
  star.style.left=Math.random()*100+"%";
  star.style.animationDuration=(2+Math.random()*4)+"s";
  star.style.opacity=Math.random();
  starContainer.appendChild(star);
}

/* ===== LANGUAGE ===== */
let currentLanguage="en";
let lastData=null;
const translations={
  en:{day:"Day",date:"Date",fajr:"Fajr",dhuhr:"Dhuhr",asr:"Asr",maghrib:"Maghrib",isha:"Isha",next:"Next Prayer"},
  ar:{day:"ÿßŸÑŸäŸàŸÖ",date:"ÿßŸÑÿ™ÿßÿ±ŸäÿÆ",fajr:"ÿßŸÑŸÅÿ¨ÿ±",dhuhr:"ÿßŸÑÿ∏Ÿáÿ±",asr:"ÿßŸÑÿπÿµÿ±",maghrib:"ÿßŸÑŸÖÿ∫ÿ±ÿ®",isha:"ÿßŸÑÿπÿ¥ÿßÿ°",next:"ÿßŸÑÿµŸÑÿßÿ© ÿßŸÑŸÇÿßÿØŸÖÿ©"},
  hi:{day:"‡§¶‡§ø‡§®",date:"‡§§‡§æ‡§∞‡•Ä‡§ñ",fajr:"‡§´‡§ú‡•ç‡§∞",dhuhr:"‡§ú‡§º‡•Å‡§π‡§∞",asr:"‡§Ö‡§∏‡§∞",maghrib:"‡§Æ‡§ó‡§∞‡§ø‡§¨",isha:"‡§à‡§∂‡§æ",next:"‡§Ö‡§ó‡§≤‡•Ä ‡§®‡§Æ‡§æ‡§ú‡§º"},
  ur:{day:"ÿØŸÜ",date:"ÿ™ÿßÿ±€åÿÆ",fajr:"ŸÅÿ¨ÿ±",dhuhr:"ÿ∏€Åÿ±",asr:"ÿπÿµÿ±",maghrib:"ŸÖÿ∫ÿ±ÿ®",isha:"ÿπÿ¥ÿßÿ°",next:"ÿß⁄ØŸÑ€å ŸÜŸÖÿßÿ≤"}
};
function changeLanguage(lang){
  currentLanguage=lang;
  document.body.style.direction=(lang==="ar"||lang==="ur")?"rtl":"ltr";
  if(lastData) renderCalendar(lastData);
}

/* ===== TIME FORMAT ===== */
function convertToAMPM(time){
  time=time.replace(/ \(.*\)/,'');
  let [h,m]=time.split(":");
  h=parseInt(h);
  let ampm=h>=12?"PM":"AM";
  h=h%12; h=h? h:12;
  return h+":"+m+" "+ampm;
}

/* ===== PRAYER SYSTEM ===== */
let prayerTimesToday=null;
let adhaanEnabled=true;
let lastAdhaanMinute=null;

function toggleAdhaan(){
  adhaanEnabled=!adhaanEnabled;
  document.getElementById("adhaanBtn").innerText=
    adhaanEnabled?"üîä Auto Adhaan ON":"üîá Auto Adhaan OFF";
}

function initializePrayerSystem(timings){
  prayerTimesToday={
    Fajr:timings.Fajr.substring(0,5),
    Dhuhr:timings.Dhuhr.substring(0,5),
    Asr:timings.Asr.substring(0,5),
    Maghrib:timings.Maghrib.substring(0,5),
    Isha:timings.Isha.substring(0,5)
  };
  setInterval(updatePrayerSystem,1000);
}

function updatePrayerSystem(){
  if(!prayerTimesToday) return;
  let now=new Date();
  let ch=now.getHours().toString().padStart(2,'0');
  let cm=now.getMinutes().toString().padStart(2,'0');
  let current=ch+":"+cm;

  let next=null,nextName=null;
  for(let p in prayerTimesToday){
    if(current<prayerTimesToday[p]){
      next=prayerTimesToday[p]; nextName=p; break;
    }
  }
  if(!next){ next=prayerTimesToday.Fajr; nextName="Fajr (Tomorrow)"; }

  let [h,m]=next.split(":");
  let nextDate=new Date();
  nextDate.setHours(parseInt(h)); nextDate.setMinutes(parseInt(m)); nextDate.setSeconds(0);
  if(current>next) nextDate.setDate(nextDate.getDate()+1);

  let diff=nextDate-now;
  let hh=Math.floor(diff/1000/60/60);
  let mm=Math.floor((diff/1000/60)%60);
  let ss=Math.floor((diff/1000)%60);

  document.getElementById("nextPrayerDisplay").innerHTML=
    translations[currentLanguage].next+": "+nextName;
  document.getElementById("countdownTimer").innerHTML=hh+"h "+mm+"m "+ss+"s";

  for(let p in prayerTimesToday){
    if(current===prayerTimesToday[p] && lastAdhaanMinute!==current && adhaanEnabled){
      document.getElementById("adhaanAudio").play();
      lastAdhaanMinute=current;
    }
  }
}

/* ===== LOCATION ===== */
function getLocation(){
  navigator.geolocation.getCurrentPosition(async pos=>{
    const lat=pos.coords.latitude; const lon=pos.coords.longitude;
    const response=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
    const data=await response.json();
    let city=data.address.city || data.address.town || data.address.village || data.address.state;
    let country=data.address.country;
    loadRamadan(city,country);
  },()=>{alert("Location permission denied.");});
}
function manualSearch(){
  let city=document.getElementById("city").value.trim();
  if(city===""){alert("Please enter city name."); return;}
  loadRamadan(city,"");
}

/* ===== LOAD & RENDER ===== */
async function loadRamadan(city,country){
  let hijriYear=new Date().getFullYear()-579;
  const response=await fetch(`https://api.aladhan.com/v1/hijriCalendarByCity/${hijriYear}/9?city=${city}&country=${country}&method=4`);
  const data=await response.json();
  lastData=data;
  renderCalendar(data);
}

function renderCalendar(data){
  let todayDate=new Date();
  let currentDay=todayDate.getDate();
  let today=data.data.find(d=>parseInt(d.date.gregorian.day)===currentDay) || data.data[0];

  document.getElementById("todayDateDisplay").innerHTML=
    today.date.gregorian.date+" | "+today.date.hijri.date;

  document.getElementById("todayPrayers").innerHTML=`
    <p class="highlight">${translations[currentLanguage].fajr}: ${convertToAMPM(today.timings.Fajr)}</p>
    <p>${translations[currentLanguage].dhuhr}: ${convertToAMPM(today.timings.Dhuhr)}</p>
    <p>${translations[currentLanguage].asr}: ${convertToAMPM(today.timings.Asr)}</p>
    <p class="highlight">${translations[currentLanguage].maghrib}: ${convertToAMPM(today.timings.Maghrib)}</p>
    <p>${translations[currentLanguage].isha}: ${convertToAMPM(today.timings.Isha)}</p>
  `;

  initializePrayerSystem(today.timings);

  let table=`<table><tr>
    <th>${translations[currentLanguage].day}</th>
    <th>${translations[currentLanguage].date}</th>
    <th>${translations[currentLanguage].fajr}</th>
    <th>${translations[currentLanguage].dhuhr}</th>
    <th>${translations[currentLanguage].asr}</th>
    <th>${translations[currentLanguage].maghrib}</th>
    <th>${translations[currentLanguage].isha}</th>
  </tr>`;

  data.data.forEach((day,index)=>{
    let isToday=parseInt(day.date.gregorian.day)===currentDay;
    table+=`<tr class="${isToday?'current-day':''}">
      <td>${index+1}</td>
      <td>${day.date.gregorian.date}<div class="hijri-date">${day.date.hijri.date}</div></td>
      <td class="highlight">${convertToAMPM(day.timings.Fajr)}</td>
      <td>${convertToAMPM(day.timings.Dhuhr)}</td>
      <td>${convertToAMPM(day.timings.Asr)}</td>
      <td class="highlight">${convertToAMPM(day.timings.Maghrib)}</td>
      <td>${convertToAMPM(day.timings.Isha)}</td>
    </tr>`;
  });
  table+="</table>";
  document.getElementById("calendar").innerHTML=table;
}

/* ===== DOWNLOAD PDF ===== */
function downloadPDF(){
  html2pdf().from(document.getElementById("content")).save("Ramadan-Prayer-Times.pdf");
}
</script>
</body>
</html>

