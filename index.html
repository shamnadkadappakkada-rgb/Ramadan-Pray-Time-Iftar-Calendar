<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Worldwide Ramadan Calendar with Prayer Times</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Poppins:wght@300;400;600;700&display=swap');

body{
margin:0;
font-family:'Poppins',sans-serif;
background:#0b0c10;
color:white;
overflow-x:hidden;
}

.overlay{
position:fixed;
width:100%;
height:100%;
background:linear-gradient(135deg,#000000,#000c25);
z-index:-2;
}

.top-banner{
position:relative;
text-align:center;
padding:120px 10px 30px;
}

.highlight{
background:rgba(212,175,55,0.18);
border:1px solid rgba(212,175,55,0.5);
color:#d4af37;
font-weight:600;
border-radius:6px;
}

.current-day{
background:rgba(212,175,55,0.25) !important;
border-left:3px solid #d4af37;
}
</style>
</head>

<body>

<div class="overlay"></div>

<div class="top-banner">
<h1>üåô Ramadan Mubarak | ÿ±ŸÖÿ∂ÿßŸÜ ŸÖÿ®ÿßÿ±ŸÉ</h1>
<p><strong>Worldwide Ramadan Calendar-2026</strong></p>
<p id="todayDateDisplay"></p>

<!-- ===== ADHAAN TIMER ADDED START ===== -->
<div id="countdownTimer" class="highlight" style="display:inline-block;padding:8px 15px;margin-top:10px;"></div>
<!-- ===== ADHAAN TIMER ADDED END ===== -->

<div id="todayPrayers"></div>
</div>

<div class="container" id="content">

<div class="controls">
<button onclick="getLocation()">üìç Auto Detect</button>
<input type="text" id="city" placeholder="Enter City">
<button onclick="manualSearch()">Search</button>
<button onclick="toggleAdhaan()">üîä Adhaan ON</button>
</div>

<div id="calendar"></div>
</div>

<audio id="adhaanAudio" preload="auto">
<source src="https://cdn.islamic.network/audio/adhan/adhan.mp3" type="audio/mpeg">
</audio>

<script>

let adhaanEnabled=true;
let lastData=null;

/* ===============================
   AUTO DETECT FULLY WORKING
================================ */
function getLocation(){
if(navigator.geolocation){
navigator.geolocation.getCurrentPosition(async function(position){
let lat=position.coords.latitude;
let lon=position.coords.longitude;

const geo=await fetch(`https://api.aladhan.com/v1/reverseGeocoding?latitude=${lat}&longitude=${lon}`);
const geoData=await geo.json();

let city=geoData.data.city;
let country=geoData.data.country;

loadRamadan(city,country);

});
}else{
alert("Geolocation not supported");
}
}

/* Remove (+03) etc */
function cleanTime(time){
return time.split(" ")[0];
}

function convertToAMPM(time){
let t=time.split(":");
let hours=parseInt(t[0]);
let minutes=t[1];
let ampm=hours>=12?"PM":"AM";
hours=hours%12;
hours=hours?hours:12;
return hours+":"+minutes+" "+ampm;
}

async function loadRamadan(city,country){
let hijriYear=new Date().getFullYear()-579;
const response=await fetch(`https://api.aladhan.com/v1/hijriCalendarByCity/${hijriYear}/9?city=${city}&country=${country}&method=4`);
const data=await response.json();
lastData=data;
renderCalendar(data);
}

function manualSearch(){
let city=document.getElementById("city").value;
loadRamadan(city,"");
}

function toggleAdhaan(){
adhaanEnabled=!adhaanEnabled;
}

/* ===============================
   MAIN RENDER
================================ */
function renderCalendar(data){

let todayDate=new Date();
let currentDay=todayDate.getDate();
let today=data.data.find(d=>parseInt(d.date.gregorian.day)===currentDay) || data.data[0];

document.getElementById("todayDateDisplay").innerHTML=
`${today.date.gregorian.date} | ${today.date.hijri.date}`;

let fajrTime=cleanTime(today.timings.Fajr);
let maghribTime=cleanTime(today.timings.Maghrib);

document.getElementById("todayPrayers").innerHTML=`
<p class="highlight">üåÖ Fajr: ${convertToAMPM(fajrTime)}</p>
<p>Dhuhr: ${convertToAMPM(cleanTime(today.timings.Dhuhr))}</p>
<p>Asr: ${convertToAMPM(cleanTime(today.timings.Asr))}</p>
<p class="highlight">üåô Maghrib: ${convertToAMPM(maghribTime)}</p>
<p>Isha: ${convertToAMPM(cleanTime(today.timings.Isha))}</p>
`;

/* ===== ADHAAN TIMER ADDED START ===== */
startAdhaanTimer(fajrTime, maghribTime);
/* ===== ADHAAN TIMER ADDED END ===== */

let table=`<table><tr>
<th>Day</th>
<th>Date</th>
<th>Fajr</th>
<th>Dhuhr</th>
<th>Asr</th>
<th>Maghrib</th>
<th>Isha</th>
</tr>`;

data.data.forEach((day,index)=>{
let isToday=parseInt(day.date.gregorian.day)===currentDay;

table+=`<tr class="${isToday?'current-day':''}">
<td>${index+1}</td>
<td>${day.date.gregorian.date}<br>${day.date.hijri.date}</td>
<td class="highlight">${convertToAMPM(cleanTime(day.timings.Fajr))}</td>
<td>${convertToAMPM(cleanTime(day.timings.Dhuhr))}</td>
<td>${convertToAMPM(cleanTime(day.timings.Asr))}</td>
<td class="highlight">${convertToAMPM(cleanTime(day.timings.Maghrib))}</td>
<td>${convertToAMPM(cleanTime(day.timings.Isha))}</td>
</tr>`;
});

table+="</table>";
document.getElementById("calendar").innerHTML=table;
}

/* ===== ADHAAN TIMER ADDED START ===== */
function startAdhaanTimer(fajr, maghrib){

function parseTimeToDate(timeStr){
let [h,m]=timeStr.split(":");
let now=new Date();
let t=new Date();
t.setHours(parseInt(h));
t.setMinutes(parseInt(m));
t.setSeconds(0);
if(t<now) t.setDate(t.getDate()+1);
return t;
}

let fajrDate=parseTimeToDate(fajr);
let maghribDate=parseTimeToDate(maghrib);

setInterval(function(){

let now=new Date();
let nextPrayer= now < fajrDate ? fajrDate : maghribDate;
let diff=nextPrayer-now;

let hours=Math.floor(diff/1000/60/60);
let minutes=Math.floor((diff/1000/60)%60);
let seconds=Math.floor((diff/1000)%60);

document.getElementById("countdownTimer").innerHTML=
"Next Adhaan in: "+hours+"h "+minutes+"m "+seconds+"s";

if(hours===0 && minutes===0 && seconds===0){
if(adhaanEnabled){
document.getElementById("adhaanAudio").play();
}
}

},1000);
}
/* ===== ADHAAN TIMER ADDED END ===== */

</script>
</body>
</html>
